{"version":3,"file":"clicked.js","sources":["../clicked.js"],"sourcesContent":["/**\n * Watcher for click, double-click, or long-click event for both mouse and touch\n * @example\n * import { clicked } from 'clicked'\n *\n * function handleClick()\n * {\n *    console.log('I was clicked.')\n * }\n *\n * const div = document.getElementById('clickme')\n * const c = clicked(div, handleClick, { threshold: 15 })\n *\n * // change callback\n * c.callback = () => console.log('different clicker')\n *\n * // destroy\n * c.destroy()\n *\n * // using built-in querySelector\n * clicked('#clickme', handleClick2)\n *\n * // watching for all types of clicks\n * function handleAllClicks(e) {\n *     switch (e.type)\n *     {\n *         case 'clicked': ...\n *         case 'double-clicked': ...\n *         case 'long-clicked': ...\n *     }\n *\n *     // view UIEvent that caused callback\n *     console.log(e.event)\n * }\n * clicked('#clickme', handleAllClicks, { doubleClicked: true, longClicked: true })\n */\n\n/** @type {object} */\nconst defaultOptions = {\n    threshold: 10,\n    clicked: true,\n    doubleClicked: false,\n    doubleClickedTime: 300,\n    longClicked: false,\n    longClickedTime: 500,\n    capture: false,\n    clickDown: false\n}\n\n/**\n * @param {HTMLElement|string} element or querySelector entry (e.g., #id-name or .class-name)\n * @param {ClickedCallback} callback called after a click, double click, or long click is registered\n * @param {object} [options]\n * @param {number} [options.threshold=10] if touch moves threshhold-pixels then the touch-click is cancelled\n * @param {boolean} [options.clicked=true] disable watcher for default clicked event\n * @param {boolean} [options.doubleClicked] enable watcher for double click\n * @param {number} [options.doubleClickedTime=500] wait time in millseconds for double click\n * @param {boolean} [options.longClicked] enable watcher for long click\n * @param {number} [options.longClickedTime=500] wait time for long click\n * @param {boolean} [options.clickDown] enable watcher for click start\n * @param {boolean} [options.capture]  events will be dispatched to this registered listener before being dispatched to any EventTarget beneath it in the DOM tree\n * @returns {Clicked}\n */\nexport function clicked(element, callback, options)\n{\n    return new Clicked(element, callback, options)\n}\n\nclass Clicked\n{\n    constructor(element, callback, options)\n    {\n        if (typeof element === 'string')\n        {\n            element = document.querySelector(element)\n            if (!element)\n            {\n                console.warn(`Unknown element: document.querySelector(${element}) in clicked()`)\n                return\n            }\n        }\n        this.options = Object.assign({}, defaultOptions, options)\n        this.events = {\n            mousedown: (e) => this.mousedown(e),\n            mouseup: (e) => this.mouseup(e),\n            mousemove: (e) => this.mousemove(e),\n            touchstart: (e) => this.touchstart(e),\n            touchmove: (e) => this.touchmove(e),\n            touchcancel: (e) => this.cancel(e),\n            touchend: (e) => this.touchend(e)\n        }\n        element.addEventListener('mousedown', this.events.mousedown, { capture: this.options.capture })\n        element.addEventListener('mouseup', this.events.mouseup, { capture: this.options.capture })\n        element.addEventListener('mousemove', this.events.mousemove, { capture: this.options.capture })\n        element.addEventListener('touchstart', this.events.touchstart, { passive: true, capture: this.options.capture })\n        element.addEventListener('touchmove', this.events.touchmove, { passive: true, capture: this.options.capture })\n        element.addEventListener('touchcancel', this.events.touchcancel, { capture: this.options.capture})\n        element.addEventListener('touchend', this.events.touchend, { capture: this.options.capture })\n        this.element = element\n        this.callback = callback\n    }\n\n    /**\n     * removes event listeners added by Clicked\n     */\n    destroy()\n    {\n        this.element.removeEventListener('mousedown', this.events.mousedown)\n        this.element.removeEventListener('mouseup', this.events.mouseup)\n        this.element.removeEventListener('mousemove', this.events.mousemove)\n        this.element.removeEventListener('touchstart', this.events.touchstart, { passive: true })\n        this.element.removeEventListener('touchmove', this.events.touchmove, { passive: true })\n        this.element.removeEventListener('touchcancel', this.events.touchcancel)\n        this.element.removeEventListener('touchend', this.events.touchend)\n    }\n\n    touchstart(e)\n    {\n        if (this.down === true)\n        {\n            this.cancel()\n        }\n        else\n        {\n            if (e.touches.length === 1)\n            {\n                this.handleDown(e.changedTouches[0].screenX, e.changedTouches[0].screenY)\n            }\n        }\n    }\n\n    pastThreshold(x, y)\n    {\n        return Math.abs(this.lastX - x) > this.options.threshold || Math.abs(this.lastY - y) > this.options.threshold\n    }\n\n    touchmove(e)\n    {\n        if (this.down)\n        {\n            if (e.touches.length !== 1)\n            {\n                this.cancel()\n            }\n            else\n            {\n                const x = e.changedTouches[0].screenX\n                const y = e.changedTouches[0].screenY\n                if (this.pastThreshold(x, y))\n                {\n                    this.cancel()\n                }\n            }\n        }\n    }\n\n    /** cancel current event */\n    cancel()\n    {\n        this.down = false\n        if (this.doubleClickedTimeout)\n        {\n            clearTimeout(this.doubleClickedTimeout)\n            this.doubleClickedTimeout = null\n        }\n        if (this.longClickedTimeout)\n        {\n            clearTimeout(this.longClickedTimeout)\n            this.longClickedTimeout = null\n        }\n    }\n\n    touchend(e)\n    {\n        if (this.down)\n        {\n            e.preventDefault()\n            this.handleClicks(e, e.pointerId)\n        }\n    }\n\n    handleClicks(e)\n    {\n        if (this.options.doubleClicked)\n        {\n            this.doubleClickedTimeout = setTimeout(() => this.doubleClickedCancel(e), this.options.doubleClickedTime)\n        }\n        else if (this.options.clicked)\n        {\n            this.callback({ event: e, type: 'clicked' })\n        }\n        if (this.longClickedTimeout)\n        {\n            clearTimeout(this.longClickedTimeout)\n            this.longClickedTimeout = null\n        }\n        this.down = false\n    }\n\n    handleDown(e, x, y)\n    {\n        if (this.doubleClickedTimeout)\n        {\n            if (this.pastThreshold(x, y))\n            {\n                if (this.options.clicked)\n                {\n                    this.callback({ event: e, type: 'clicked' })\n                }\n                this.cancel()\n            }\n            else\n            {\n                this.callback({ event: e, type: 'double-clicked' })\n                this.cancel()\n            }\n        }\n        else\n        {\n            this.lastX = x\n            this.lastY = y\n            this.down = true\n            if (this.options.longClicked)\n            {\n                this.longClickedTimeout = setTimeout(() => this.longClicked(e), this.options.longClickedTime)\n            }\n            if (this.options.clickDown) {\n                this.callback({ event: e, type: 'click-down' })\n            }\n        }\n    }\n\n    longClicked(e)\n    {\n        this.longClikedTimeout = null\n        this.down = false\n        this.callback({ event: e, type: 'long-clicked' })\n    }\n\n    doubleClickedCancel(e)\n    {\n        this.doubleClickedTimeout = null\n        if (this.options.clicked)\n        {\n            this.callback({ event: e, type: 'double-clicked' })\n        }\n    }\n\n    mousedown(e)\n    {\n        if (this.down === true)\n        {\n            this.down = false\n        }\n        else\n        {\n            this.handleDown(e, e.screenX, e.screenY)\n        }\n    }\n\n    mousemove(e)\n    {\n        if (this.down)\n        {\n            const x = e.screenX\n            const y = e.screenY\n            if (this.pastThreshold(x, y))\n            {\n                this.cancel()\n            }\n        }\n    }\n\n    mouseup(e)\n    {\n        if (this.down)\n        {\n            e.preventDefault()\n            this.handleClicks(e)\n        }\n    }\n}\n\n/**\n * Callback for\n * @callback Clicked~ClickedCallback\n * @param {UIEvent} event\n * @param {('clicked'|'double-clicked'|'long-clicked'|'click-down')} type\n */"],"names":["defaultOptions","threshold","clicked","doubleClicked","doubleClickedTime","longClicked","longClickedTime","capture","clickDown","Clicked","[object Object]","element","callback","options","document","querySelector","this","Object","assign","events","mousedown","e","mouseup","mousemove","touchstart","touchmove","touchcancel","cancel","touchend","addEventListener","passive","console","warn","removeEventListener","down","touches","length","handleDown","changedTouches","screenX","screenY","x","y","Math","abs","lastX","lastY","pastThreshold","doubleClickedTimeout","clearTimeout","longClickedTimeout","preventDefault","handleClicks","pointerId","setTimeout","doubleClickedCancel","event","type","longClikedTimeout"],"mappings":"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"}